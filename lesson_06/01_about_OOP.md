# ブロックチェーンって何ぞや
ブロックチェーンとは果たして何なのでしょうか？

名前からすると、ブロックが連なっているイメージ。
これがどうして通貨と結びついたり、革新的と呼ばれるのでしょうか？

本稿では、ブロックチェーンと切っても切り離せない Bitcoin の概要とその歴史
そして、ブロックチェーンの技術を中心に学んで参りましょう。

## ブロックチェーンと Bitcoin
ブロックチェーンを語る上で絶対に欠かせない物。
それは Bitcoin です。

さて、ここで問題です。

ここで取り上げる『ブロックチェーン』という概念が生まれたのはいつでしょうか？

正解は……

### ブロックチェーンという概念の誕生
わかりやすくする為に、正解の前に少しストーリーを挟みましょう。

2008年 に Satoshi Nakamoto が発表した論文 "Bitcoin: A Peer-to-Peer Electronic Cash System" では、
ブロックチェーンという単語が出てきません。

Bitcoin 今までの様々な技術を組み合わせて、世に生み出されました。
その中の技術の一つであり、根幹を担うのがブロックチェーンです。

Bitcoin が実装され、広まる中でその根幹技術であるブロックチェーンがクローズアップされました。

とすると、一つの正解は Bitcoin によって生み出されたのがブロックチェーンであり、
ブロックチェーン ≒ Bitcoin とも言えます。

### ブロックチェーンの系譜
とは言え、ブロックチェーン技術は Satoshi Nakamoto により突如発明された物ではありません。
今までの様々な研究によって生み出された概念を融合して作られた物です。
では、どのような技術で作られているのでしょうか？

1990年 に Stuart Haber W. Scott Stornett による論文 "How to Time-stamp a digital document" で、
ブロックチェーンの基礎ともなるタイムスタンプのチェーン利用が発表されました。
これは 2004年 に技術標準化されています。

また、1992年 に発表された "Cryptographic Puzzle" はブロックチェーン生成に関連する Proof of Work の原型と言えます。

※ Proof of Work の詳細は後述します

### ブロックチェーンはいつ生まれたのか？
この事から、ブロックチェーン自体はコンピュータサイエンスの様々な結晶により、
1990年頃より胎動し、Bitcoin によってこの世に生み出された技術だと言えます。

### ブロックチェーンの成長
ブロックチェーンは様々なサービスに利用されるべく、現在も研究開発が続いています。
これはインターネットという概念が提唱され、研究開発を経て現代人に欠かせない技術になった事に通じる物があるかもしれません。

## 歴史
ブロックチェーンとは何なのか？
具体的な学習の前にブロックチェーン及び、Bitcoin、 そして、それを取り巻く歴史を紐解いていきましょう。

## ブロックチェーンとは
それでは、具体的にブロックチェーンの特徴を Bitcoin を例に見ていきましょう。

### ブロックチェーンの概要
ブロックチェーンとは P2Pネットワーク を介した分散型データベースシステムであり、
読んで字の如く、データベースであるブロックをチェーンで繋ぐ事で、過去のブロックと現在のブロックと連鎖させていきます。
これは C言語 で言うところのポインタに近い概念と言えます。

### ブロック
このブロックには、幾つものトランザクションを含んでおり、Bitcoin ではトランザクションは通貨の決済情報が格納されます。
現在のブロックは過去の全てのブロックの Hash値 により計算され、『正しく過去の全ての歴史を踏襲したブロック』のみ連鎖させます。
これにより過去のデータを改ざんする事が困難なため、データベースの正当性が担保されます。
つまり、決済の情報はデータベースに格納され、改ざんが困難なためそれは信用に足る情報だと言えます。
また、過去の全てのブロックを Hash値 により計算するため、ブロックは新しくなるほど計算が複雑になるという仕様があります。

### トランザクション
トランザクションはどのようなものでしょうか？
トランザクションは、インプット、アウトプット部で構成されます。
インプットからアウトプット、そして次のインプットへとチェーンされていきます。

ざっくりした構成は下記になります。

- インプットトランザクション
    - 前回アウトプットトランザクションの Hash値
    - 前回アウトプットのインデックス
    - 支払いをする者の秘密鍵で Hash化 された 署名Script
アウトプット
    - トランザクションID
    - 支払いを受ける者ので Hash化 された Bitcoinアドレス
    - 支払いを受ける者の公会鍵で Hash化 された トランザクション Script
    - 金額情報
        - 支払い金額
        - おつり金額
        - 決済手数料

トランザクションの送り先は 支払いを受ける者の公開鍵で hash化 された Bitcoinアドレスになります。

このトランザクションは、支払いをする者の秘密鍵でのみ 署名Script を復号が可能であり、
それにより決済の正当性が証明されます。
これを解除条件と言い、決済の正当性が証明されたトランザクションはブロックのチェーンに追加されていきます。

秘密鍵が漏洩して巨額の金額が盗まれたというニュースが流れますが、
ブロックチェーンにとって秘密鍵だけが決済の正当性を証明するため、
その扱いは極めてセキュアさが求められます。

### ネットワーク
ブロックチェーンのデータベースは安全に思われますが、ハッキングの可能性は捨てきれません。
そこで登場するのが P2P によるネットワークです。

P2P はクライアント/サーバシステムのように中央集権的な構成ではなく、
クライアント同士がネットワークで結びつくことでシステムを構成します。

P2P のため匿名性は高いですが、ネットワーク利用から利用者を追う事は可能であり、Bitcoin では完全な匿名性はありません。
ブロックチェーンアプリケーションの中でも匿名性に特化したものも作れらています。

ブロックチェーンの場合、データベースが幾つものクライアントに保持される事により、
一つのデータベースがハッキングされても、
その他大多数のデータベースが無事ならばハッキングされたデータベースは改ざんされたとみなしてチェーンから弾きます。
これは多数決システムであり、もし、ハッキングしようと思うならば世界中の 50% を上回るデータベースを同時に攻撃する必要があります。
これを 51%攻撃と言います。

#### 51%攻撃
それにもし51%攻撃があったとしても、それまで何年も集積されてきたデータベースがあるため、
突如情報が改ざんされても、ハッキングの情報元を検知し、弾く事ができるでしょう。

ただし、ブロックチェーンの全てではなくても、直近のブロックについては、51%攻撃の懸念があります。
全世界のクラッカーが結託し、直近に的を絞ってブロックを改ざんしようと思えば直近数ブロック程ならば改ざんが可能だと言われています。
改ざん可能性の目安は 6ブロック と言われており、それより深くなると改ざんのリスクは急激に減少します。

攻撃を防ぐ為にはブロック数を増やしトランザクションが多い程に安全になります。

そのための仕組みがマイナーへの報酬になります。

### マイニング
マイニングは発掘のことです。
発掘を行うノードは、マイナー (Miner: 発掘者)と呼ばれます。

ブロックチェーンはその仕様上、ブロックを増やす事でより強固なセキュリティを保つ事ができます。
しかし、メリットがなければ誰もブロックを増やしてはくれないことでしょう。

そこで、ブロックを新規に計算するマイナーに対して、その報酬として通貨を発行するというのが Bitcoin のミソです。

マイナーは、過去の全てのブロックから Hash値 を計算して新しいブロックを生成します。
このコストはバカにならず、大きな CPU負荷 を貸します。
マイナーはマイニングコストに見合うだけの報酬を得ることで、意欲的にブロックを成長させて行きます。

また、マイナーの報酬はマイニング時の報酬だけでなく、トランザクションの手数料を受け取る権利を得ます。
これがマイナーにとってのモチベーションとなります。

#### 新しいブロックの生成
新しいブロックは、直近のブロックが生成された後、直近のブロックを含む過去の Hash値の計算を行います。
言わば、直近のブロックが生成された瞬間に次のレースが始まります。
Hash 値の計算はランダムであり、新しいブロックのマイニングはパソコンの性能が重要な物の運次第です。
これにより、新規参入者でも宝くじに当たるよりは高い確率で新しいブロックをマイニングするチャンスがあります。

### Proof of Work
しかし、マイニング時の通貨報酬と手数料を受け取る権利があれば、すぐにマイニングされつくされそうに思われます。
それにパソコンの性能が上がれば加速度的にマイニングが進みそうに思われます。

そこで登場するのが Proof of Work です。

Proof of Work は、difficulty target と呼ばれる計算難易度を動的に設定し、新しいブロックが生成されるタイミングを調整します。
Bitcoin では約 10分 に一度新しいブロックが生成されるように設定されています。
これにより、その次代のパソコン性能に関わらず一定して新しいブロックが生成されるようになります。

### ブロックチェーンとは まとめ
ブロックチェーンの機能について一通り説明致しました。
この仕様、新しい事が着々とこの世に出現していく様はワクワクします。

ブロックチェーンは現在も研究開発されており、よりセキュアで高速処理が行われるように工夫が重ねられています。

## ブロックチェーンを構成する技術要素
ブロックチェーンを一通り学んだ所で、実際にどういう技術が使われているのか見ていきましょう。
ブロックチェーンは、幾つかの基礎技術の応用で成り立っています。
これは、ゲームボーイを作り出した横井軍平氏の哲学「枯れた技術の水平思考」に通じる物があるかもしれません。

### 枯れた技術の水平思考
「枯れた技術」は、「すでに広く使用されてメリット・デメリットが明らかになっている技術」のことで、「水平思考」（エドワード・デボノ提唱）は、「既存の概念に捉われず新しい角度から物事を見る」ということであり、要は「既存の技術を既存の商品とは異なる使い方をしてまったく新しい商品を生み出す」。結果的に開発コストを低く抑えることができるのが特徴。
(by wikipedia)

## ブロックチェーンを構成する基礎技術
ブロックチェーンを構成する基礎的技術を見ていきましょう。

- ネットワーク
    - P2P
    - RESTful API
- 暗号化技術
    - 公開鍵認証
    - タイムスタンプ
- Proof of Work

### P2P
P2P は Peer to Peer の略で、クライアント/サーバ方式に頼らない、
クライアント同士の直接の通信を指します。

広義で言えば、パソコンに接続する 外付けHDD やプリンタ等も P2P だと言えます。

一般的にはインターネットを介した クライアント間通信を指し、次のようなメリット/デメリットがあります。

#### P2P メリット
- 高スケーラビリティ
- 低コスト
- 匿名性

#### P2P デメリット
- 速度が遅い
- 匿名性による通信車特定難易度

### RESTFUL API
REpresentational State Transfer の略称の事で、インターネットによる通信において、
URI と通信メソッド(GET, POST, PUT, DELETE)によって、処理内容を決定する考え方のこと。

クライアント間の通信をシンプルに整合性を保つ事が可能でありメンテナンス性を高める効果がある

### 公開鍵認証
1960年代 に原型となる理論が考案され、その後様々な研究を経て1970年代に   実用化された重要技術。
お馴染み SSL 通信も公開鍵認証を利用。

公開鍵認証では、秘密鍵、公開鍵を用いる事で決済当事者間の証明を行っています。

ブロックチェーンでは、セキュリティを担保するため、マスターキーとなる秘密鍵から子となる秘密鍵を作成する仕組みが用意されています。

#### Hash
あるデータを特定の条件で算出する技術。
暗号鍵による 値の Hash化を行う事で本人を証明する事が可能です。
これは署名と言われます。

Hash は桁数が大きくなると再現が難しく、ほぼユニークと言える値になります。

新しいブロックの生成で Hash は利用され、
正解となる Hash値 を一番早く割り出したマイナーが新しいブロックの権利を手にします。

また、署名としても利用され、メール等で使われる Base64 が有名ですが、ブロックチェーンでは、可読性を高めた Base58が使用されます。
これは、i, I, l, 1 等の似た文字を除外した物になります。

### タイムスタンプ
暗号鍵による署名によって、認証局と呼ばれるサーバがその内容、登録日時を証明する技術です。

ブロックチェーンでは、各ブロックは署名を持ち、その署名情報によって各ブロックのチェーンの正当性を証明します。

### Proof of Work
コンセプトは1993年のジャーナル記事で示されているようにシンシア・ドワークとMoni Naorによって発明された[1] 。「プルーフ・オブ・ワーク」またはPOWという用語はマーカス・ヤコブソンとアリ・ジュルズによる1999年の論文で最初に造語され、公式化されました。
(by wikipedia)

Proof of Work は、過去のブロックの署名情報を元にして処理を行う端末にとって、
適切な高難度(Difficulty target)の 正解となる Hash値 を設定します。
マイニングにおいては、この正解を割り出す事を目的とします。

この処理はコストが掛かる(簡単には見つからない)事から、新しいブロックの正当性の証明に利用されます。

### ブロックチェーンを構成する基礎技術 まとめ
このようにブロックチェーンでは目新しい技術ではなく、過去に存在した様々な実績ある技術を組み合わせる事で実装された新しいシステムであり、概念です。

Bitcoin のイメージばかりが先行しますが、
その本質は、P2P による分散型システム上で構築されるトランザクションを保持する巨大なデータベースであり、
分散システムに適応するための暗号化技術によるセキュリティ技術により支えられています。

## ブロックチェーンの応用
暗号通貨 の利用に留まらず、Ethereum を筆頭に情報を扱うブロックチェーンも次々と生まれています。
これらの物は、トランザクションと認証に着目し、契約情報を扱うケースや、
中央集権サーバの高コストから、低コスト運用をするための基盤として利用されようとしています。

また、マイニング時に報酬の発生しない、新たな素数の発見や、医学の研究をモチベーションとしたブロックチェーンも誕生しています。
これらのトランザクションに決済情報以外を利用するものは、ブロックチェーン2.0 とも言われます。

## ブロックチェーンとは何ぞや まとめ
ブロックチェーンの世界は如何でしたでしょうか？
Bitcoin の成功と中央集権的な暗号通貨取引所の問題により、暗いイメージも付き纏うブロックチェーンですが、
これらがより洗練され発展した世界では、ブロックチェーン技術は新たなプラットフォームの可能性として様々な物に取り込まれていくのではないかと期待したい所です。

もちろん、これらの仕様を理解し、技術を習得することは新たな仕事の発見でもあります。
我々技術者にとっては、仕事のマイニングにブロックチェーンを学習するのも乙かもしれません。
